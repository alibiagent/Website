(function(a){a.TableOfContents=function(b,c,d){var e=this;e.$el=a(b);e.el=b;e.toc="";e.listStyle=null;e.tags=["h1","h2","h3","h4","h5","h6"];e.init=function(){e.options=a.extend({},a.TableOfContents.defaultOptions,d);if(typeof c=="undefined"||c==null)c=document.body;e.$scope=a(c);var b=e.$scope.find(e.tags.join(", ")).filter(":first");if(b.length!=1)return;e.starting_depth=e.options.startLevel;if(e.options.depth<1)e.options.depth=1;var f=e.tags.splice(e.options.startLevel-1,e.options.depth);e.$headings=e.$scope.find(f.join(", "));if(e.options.topLinks!==false){var g=a(document.body).attr("id");if(g==""){g=e.options.topBodyId;document.body.id=g}e.topLinkId=g}if(e.$el.is("ul")){e.listStyle="ul"}else if(e.$el.is("ol")){e.listStyle="ol"}e.buildTOC();if(e.options.proportionateSpacing===true&&!e.tieredList()){e.addSpacing()}return e};e.tieredList=function(){return e.listStyle=="ul"||e.listStyle=="ol"};e.buildTOC=function(){e.current_depth=e.starting_depth;e.$headings.each(function(a,b){var c=this.nodeName.toLowerCase().substr(1,1);if(a>0||a==0&&c!=e.current_depth){e.changeDepth(c)}e.toc+=e.formatLink(this,c,a)+"\n";if(e.options.topLinks!==false)e.addTopLink(this)});e.changeDepth(e.starting_depth,true);e.$el.html(e.toc)};e.addTopLink=function(b){var c=e.options.topLinks===true?"Top":e.options.topLinks;var d=a("<a href='#"+e.topLinkId+"' class='"+e.options.topLinkClass+"'></a>").html(c);a(b).append(d)};e.formatLink=function(b,c,d){var f=b.id;if(f==""){f=e.buildSlug(a(b).text());b.id=f}var g="<a href='#"+f+"'";if(!e.tieredList())g+=" class='"+e.depthClass(c)+"'";g+=">"+e.options.levelText.replace("%",a(b).text())+"</a>";return g};e.changeDepth=function(a,b){if(b!==true)b=false;if(!e.tieredList()){e.current_depth=a;return true}if(a>e.current_depth){var c=[];for(var d=e.current_depth;d<a;d++){c.push("<"+e.listStyle+">"+"\n")}var f="<li>\n";e.toc+=c.join(f)+f}else if(a<e.current_depth){var g=[];for(var d=e.current_depth;d>a;d--){g.push("</"+e.listStyle+">"+"\n")}e.toc+="</li>\n"+g.join("</li>"+"\n");if(!b){e.toc+="</li>\n<li>\n"}}else{if(!b){e.toc+="</li>\n<li>\n"}}e.current_depth=a};e.buildSlug=function(a){a=a.toLowerCase().replace(/[^a-z0-9 -]/gi,"").replace(/ /gi,"-");a=a.substr(0,50);return a};e.depthClass=function(a){return e.options.levelClass.replace("%",a-(e.starting_depth-1))};e.addSpacing=function(){var b=e.$headings.filter(":first").position().top;e.$headings.each(function(c,d){var f=e.$el.find("a:eq("+c+")");var g=(a(this).position().top-b)/(e.$scope.height()-b)*e.$el.height();f.css({position:"absolute",top:g})})};return e.init()};a.TableOfContents.defaultOptions={startLevel:1,depth:3,levelClass:"toc-depth-%",levelText:"%",topLinks:false,topLinkClass:"toc-top-link",topBodyId:"toc-top",proportionateSpacing:false};a.fn.tableOfContents=function(b,c){return this.each(function(){var d=new a.TableOfContents(this,b,c);delete d})}})(jQuery)